<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      Huzeifa Naim &middot; Personal website
    
  </title>

  <link rel="stylesheet" href="/public/css/normalize.css">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/public/css/styles-custom.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/brands.css" integrity="sha384-nT8r1Kzllf71iZl81CdFzObMsaLOhqBU1JD2+XoAALbdtWaXDOlWOZTR4v1ktjPE" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/fontawesome.css" integrity="sha384-HbmWTHay9psM8qyzEKPc8odH4DsOuzdejtnr+OFtDmOcIVnhgReQ4GZBH7uwcjf6" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Huzeifa Naim" href="/atom.xml">
</head>


  <body>
      <header class="masthead">
        <!--
        <h3 class="masthead-title">
          <a href="/" title="Home">Huzeifa Naim</a>
          <small>Personal website</small>
        </h3>
      -->
      <div class="container">
        <div class="row">
          <div class="col-8">
            <h1 class="masthead-title">
              <a href="/" title="Home">Huzeifa<b>Naim</b></a>
            </h1>
          </div>
          <div class="col-4">
            <nav>
            <ul class="nav nav-header">
              <li><a href="/about" title="About Me">About Me</a></li>
              <li><a href="/archives" title="Archives">Archives</a></li>
            </ul>
          </nav>
          </div>
        </div>
      </div>
      </header>
      
      <section class="jumbotron">
          <div id="overlay"></div>
          <div class="container">
            <h1 class="title">Hi! I am Huzeifa.</h1>
            <p class="sub">I love to design and build <b>hardware</b> that matters.</p>
          </div>
      </section>
      


      <main class="main">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/circuits/2017/08/27/constant-current-source/">
        Simulating a Constant-Current Source Circuit using Qucs
      </a>
    </h1>

    <time datetime="2017-08-27T00:00:00+03:00" class="post-date">27 Aug 2017</time>

    <p>Circuit simulation is a very important skill to acquire since it aids in verifying circuit designs and helps you to master ciruit analysis.</p>

<p>In this post, I will show you how to use Qucs to perform a circuit simulation of a simple current source circuit employing a bipolar junction transistor (BJT) and diodes.
This guide, however, doesn’t attempt to explain how the circuit works, but rather it is aimed at demonstrating how to simulate it using Qucs. The objective of the simulation is to measure the current supplied by the current source and to verify that the current supplied is constant over a given voltage range.</p>

<h2 id="what-is-qucs">What is Qucs?</h2>
<p>Qucs is an opensource circuit simulation software with a graphical user interface. It can be used to perform several types of simulations such as DC, AC, S-parameter, Harmonic Balance analysis, noise analysis and transient analysis. Qucs provides all the standard lumped components together with many semiconductor based devices and models such as opamps, diodes, MOSFETs, PMOSFETs and many more. In addition, digital simulation can also be performed in Qucs.</p>

<h2 id="installing-qucs">Installing Qucs</h2>
<p>Qucs is fairly easy to install and is available on all major Linux based operating systems such as Fedora, Ubuntu, Arch Linux, etc. Qucs is also available on Windows and Mac OS. Please visit the link below to learn more about obtaining Qucs for your preferred Linux based OS.</p>

<p><a href="http://qucs.sourceforge.net/download.html">Download Qucs</a></p>

<p>Ubuntu users should do a simple <code class="highlighter-rouge">sudo apt-get install qucs</code>, and Fedora users should punch in <code class="highlighter-rouge">sudo dnf install qucs</code>.</p>

<p>Once Qucs has been successfully installed on your machine, launch it using the OS program menu or simply type qucs in the terminal and hit Enter.</p>

<h2 id="exploring-the-qucs-environment">Exploring the Qucs Environment</h2>
<p>Qucs is easy to use once you have a firm grasp of its interface. I suggest you take a few minutes to explore the interface in order to familiarize yourself with the program. You can obtain a description of an icon or menu by simply hovering the mouse pointer over it.</p>

<p><img src="/public/images/constant-current source/2017-08-28-081520_1366x768_scrot.jpg" alt="Screenshot of Qucs main window" /></p>

<p>For this tutorial, I have briefly outlined the key things you need to know about the interface.</p>

<ol>
  <li>
    <p>The dotted off-white area on the right is the work area. This is where the circuits to be simulated are constructed and diagrams such as graphs and tables are placed.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">Dock Window</code> on the left, consisting of vertical tabs helps you to easily access your projects, see the contents of your simulation and select components for placing in the work area.</p>
  </li>
  <li>
    <p>The toolbar on top is useful, as it readily provides you with the function of wiring, manipulating components and executing simulations.</p>
  </li>
  <li>
    <p>To add a component in the work area, click on the <code class="highlighter-rouge">Components</code> tab availabe in the dock window. Choose the category of the component you require from the dropdown box. Resistors, capacitors and inductors are located under lumped components, semiconductor devices are available under non-linear devices etc. Select the desired component from the list and drag the pointer to the work area. At this point you will notice that the component symbol is accompanied with your mouse pointer. The orientation of the component can be altered by right clicking. Finally, left click to place the component in the work area. You will observe that the component symbol is still attached to the pointer implying that you can place another one. Press <code class="highlighter-rouge">ESC</code> or click the pointer icon in the toolbar to deactivate the placing of the component.</p>
  </li>
  <li>
    <p>To change the properties of the component, select it, right click and choose <code class="highlighter-rouge">Edit Properties</code> from the menu. A dialog box pops up, from which you can edit the name and parameters of the component. You can also decide which parameters of the component to display in the schematic. This is achieved by selecting the parameter from the properties section and checking or un-checking the <code class="highlighter-rouge">display in schematic</code> option.</p>
  </li>
  <li>
    <p>A Wire is used to connect one component to the other. It can be added from the <code class="highlighter-rouge">Insert</code> menu or the toolbar. A useful tip when wiring: to make a corner, simply right click.</p>
  </li>
  <li>
    <p>It is important to make sure that your circuit is grounded properly or otherwise the simulation will not work as intended. The <code class="highlighter-rouge">Ground</code> port is availabe in the toolbar or from the <code class="highlighter-rouge">Insert</code> menu.</p>
  </li>
  <li>
    <p>To perform the simulation, it is imperative to have a simulation block placed in your schematic. It is available in the <code class="highlighter-rouge">Components</code> tab under the <code class="highlighter-rouge">simulations</code> category.
For this tutorial we will be using the <code class="highlighter-rouge">dc simulation</code> block.</p>
  </li>
  <li>
    <p>It is also a good idea to know the keyboard shortcuts for performing various tasks as they save time. The shortcut to each task is available from the menubar; it is indicated beside the menu item for that particular task.</p>
  </li>
</ol>

<p>That’s it folks, and you are ready to make your first simulation.</p>

<h2 id="constructing-the-circuit">Constructing the Circuit</h2>
<p>The end result of the constructed circuit is shown below.</p>

<p><img src="/public/images/constant-current source/final-circuit.png" alt="Final circuit" /></p>

<p>The assembly of the circuit is an exercise left to perform on your own using the descriptions given above. I have included some notes incase if you get stuck.</p>

<ul>
  <li>
    <p>As indicated previusly, the resistor is found under the <code class="highlighter-rouge">lumped components</code> category. To change its value, refer to point no. 5 of the above section. Alternatively, you can change it directly from the work area by double-clicking on the predefined value and replacing it with your desired value. It is okay to omit the units.</p>
  </li>
  <li>
    <p>The npn transistor and the diode are located under <code class="highlighter-rouge">non-linear components</code>.</p>
  </li>
  <li>
    <p>The voltage source is obtained from the <code class="highlighter-rouge">sources</code> category.</p>
  </li>
  <li>
    <p>The ammeter measures the current flowing between the positive terminal of the voltage source and the collector of the transistor. This is where the load is supposed to be placed. It is found under <code class="highlighter-rouge">probes</code> as <code class="highlighter-rouge">Current Probe</code>. Ensure that the ammeter is positioned correctly, that is, the arrow should be pointing away from the voltage source. This can be achieved by simply right-clicking prior to placing it, or by using the rotate tool from the toolbar.</p>
  </li>
  <li>
    <p>Lastly, don’t forget to place the <code class="highlighter-rouge">dc simulation</code> block. And of-course <strong>save</strong> your work</p>
  </li>
</ul>

<p>Once you have completed the circuit construction, press <code class="highlighter-rouge">F2</code> to execute the simulation.</p>

<h2 id="performing-the-simulation">Performing the Simulation</h2>
<p>Nothing happens at this point except a new data display page opens up. This is because we haven’t yet configured the simulation to provide us with data.</p>

<p>One of the main aim of the simulation is to measure the current flowing between the collector of the transistor and the positive terminal of the voltage source. That is why we have placed a current probe between them.</p>

<p>For us to obtain the value of this current we need to add a <code class="highlighter-rouge">diagram</code> in the new data display page (You can also place it in the schematics page). There are several types of diagrams available such as Cartesian, Polar, Tabular, Smith Chart, etc.  Since we only need one discrete reading, the diagram of choice will be <code class="highlighter-rouge">Tabular</code>. In the <code class="highlighter-rouge">Components</code> tab, from the dropdown box, select <code class="highlighter-rouge">diagrams</code> and from the list choose <code class="highlighter-rouge">Tabular</code>. Drag the pointer to the page, and left click. Automatically a dialog box will popup prompting you to select the reading you would like to display. Illustrated below is the <code class="highlighter-rouge">Edit Diagram Properties</code> dialog box.</p>

<p><img src="/public/images/constant-current source/2017-08-31-113153_627x537_scrot.png" alt="Edit Diagram Properties Box" /></p>

<p>Our main area of concern is the Dataset section. It consists of a dropdown box, for selecting the dataset from which you want to display the values and, a table listing the available readings to display. In our case, we will be having <code class="highlighter-rouge">V1.I</code> and <code class="highlighter-rouge">Pr1.I</code>. Notice the naming pattern. The characters before the dot represent the name of the component from which we want to extract data;  in our case the <code class="highlighter-rouge">V1</code> for voltage source and <code class="highlighter-rouge">Pr1</code> for current probe. The letter after the dot determines whether it is a voltage reading (V) or a current reading (I). Since we require the reading from the currrent probe, double-click on the <code class="highlighter-rouge">Pr1.I</code> entry. Consequently, the Graph section will be populated with <code class="highlighter-rouge">Pr1.I</code> entry. Click on <code class="highlighter-rouge">Apply</code> followed by <code class="highlighter-rouge">OK</code>. There you go! A table with the reading from the current probe will be displayed under the column heading <code class="highlighter-rouge">Pr1.I</code>. The current is measured in Amps. A screenshot of the table is shown below.</p>

<p><img src="/public/images/constant-current source/2017-08-31-113802_369x257_scrot.png" alt="Screenshot of table with current reading" /></p>

<p>This circuit was designed to drive an LED, therefore a current of 22.2mA is registered. You can experiment with the circuit by changing the value of the <code class="highlighter-rouge">R2</code> resistor and re-simulating to observe the new value of the current reading.</p>

<p>Another cool thing you can do is calculating the <code class="highlighter-rouge">DC bias</code>. This will display the potential at each node in the circuit and the current reading on the probes. This is achieved by either pressing <code class="highlighter-rouge">F8</code> or selecting the <code class="highlighter-rouge">Simulation</code> menu from the menu bar and choosing <code class="highlighter-rouge">Calculate DC bias</code>.
The outcome is illustrated below.</p>

<p><img src="/public/images/constant-current source/2017-08-31-121407_345x430_scrot.png" alt="Calculate DC bias" /></p>

<p>Congratulations! You can now obtain meaningful data from the simulation exercise.</p>

<h2 id="going-a-step-further">Going a Step Further</h2>
<p>We also need to verify whether the current flowing is constant regardless of the voltage source value, that is, there shouldn’t be a significant variation in current when we alter the voltage source value from, let’s say, 5V to 15V. To accomplish this, we need to employ the <code class="highlighter-rouge">Parameter sweep</code> simulation. We will measure the current flowing for the following voltage range: 5 - 15V. Kindly follow the steps below to perfom the parameter sweep simulation.</p>

<ol>
  <li>
    <p>Insert the <code class="highlighter-rouge">Parameter sweep</code> simulation block in the schematics page.</p>
  </li>
  <li>
    <p>Double-click on the block to activate the properties dialog box.</p>
  </li>
  <li>
    <p>Edit the properties as follows:</p>

    <ul>
      <li><strong>Simulation</strong>: DC1</li>
      <li><strong>Sweep Parameter</strong>: Vs</li>
      <li><strong>Type</strong>: linear</li>
      <li><strong>Start</strong>: 5V</li>
      <li><strong>Stop</strong>: 15V</li>
      <li><strong>Step</strong>: 1</li>
    </ul>

    <p>Click on <code class="highlighter-rouge">Apply</code>, then select <code class="highlighter-rouge">OK</code>. The above configuration is illustrated below:</p>

    <p><img src="/public/public/images/constant-current source/2017-09-04-212716_442x379_scrot.png" alt="Parameter sweep configuration" /></p>
  </li>
  <li>
    <p>Double-click on the voltage source and replace the existing value of the voltage source to Vs. This makes a reference to the Sweep Parameter defined earlier. Click on Apply and OK. This is shown in the image below:</p>

    <p><img src="/public/images/constant-current source/2017-09-04-212851_410x348_scrot.png" alt="Edit voltage source value to Vs" /></p>
  </li>
  <li>
    <p>We will represent the data graphically on a Cartesian diagram and we will be expecting a horizontal line, implying that current is constant over the voltage range specified. To construct the graph, follow the steps outlined below:</p>

    <ul>
      <li>In the data display page, insert the <code class="highlighter-rouge">Cartesian</code> diagram and embrace yourself for the properties box.</li>
      <li>In the <code class="highlighter-rouge">Data</code> tab, from the <code class="highlighter-rouge">Dataset</code> area, double-click on the <code class="highlighter-rouge">Pr1.I</code> entry. This activates the <code class="highlighter-rouge">Graph Input</code> section that gives you the option to choose the line color, style, thickness and position of y-axis (left or right). Make the selections as you wish and proceed to the <code class="highlighter-rouge">Properties</code> tab.</li>
      <li>In the <code class="highlighter-rouge">Properties</code> tab, give appropriate labels to the x-axis and the left/right axis (this depends on the selection you made in the <code class="highlighter-rouge">Data</code> tab). At the bottom, you can also choose to show or not to show the grid, choose grid color, style and type (logarithmic). Switch to the <code class="highlighter-rouge">Limits</code> tab for the final configuration.</li>
      <li>Our area of concern will be the <code class="highlighter-rouge">left Axis</code> (or right). In that section, check the <code class="highlighter-rouge">manual</code> checkbox and edit the start, step and stop values as follows:
        <ul>
          <li><strong>start</strong>: 0.01</li>
          <li><strong>step</strong>: 0.01</li>
          <li><strong>stop</strong>: 0.04</li>
        </ul>
      </li>
      <li>Click on <code class="highlighter-rouge">Apply</code> and <code class="highlighter-rouge">OK</code>.</li>
    </ul>

    <p>The above series of steps are illustrated below:</p>

    <p><em>Data tab</em></p>

    <p><img src="/public/images/constant-current source/2017-09-04-212925_687x537_scrot.png" alt="Cartesian diagram properties, Data tab" /></p>

    <p><em>Properties tab</em></p>

    <p><img src="/public/images/constant-current source/2017-09-04-213024_687x537_scrot.png" alt="Cartesian diagram properties, Properties tab" /></p>

    <p><em>Limits Tab</em></p>

    <p><img src="/public/images/constant-current source/2017-09-04-213052_687x537_scrot.png" alt="Cartesian diagram properties, Limits tab" /></p>
  </li>
</ol>

<p>The graph and the final schematic (notice the addition of a LED as load) are shown below:</p>

<p><em>The graph</em></p>

<p><img src="/public/images/constant-current source/2017-09-04-213125_741x510_scrot.png" alt="Current against voltage graph" /></p>

<p><em>The final schematic</em></p>

<p><img src="/public/images/constant-current source/2017-09-04-213207_505x361_scrot.png" alt="The final schematic" /></p>

<p>The graph illustrates the change in current over the specified voltage range. It is fairly horizontal, and there is a minute change of 2mA between 5 and 15 volts. Although, for some applications, this change may be significant and thus a circuit with an improved accuracy is needed.</p>

<p>Bravo! You have successfully performed a parameter sweep simulation and displayed the results graphically on a cartesian diagram.</p>

<h2 id="conclusion">Conclusion</h2>
<p>This post was aimed at giving you a brief overview of the Qucs interface, showing you how to conduct circuit simulations in order to obtain measurements and, use them to verify the outcome of the circuit.</p>

<h2 id="references">References</h2>
<ul>
  <li><a href="http://qucs.sourceforge.net/index.html">Qucs project</a></li>
  <li><a href="http://www.instructables.com/id/Simple-Led-driverConstant-current-source-20-mA/">Simple Led Driver/Constant-current Source 20 MA</a></li>
</ul>

  </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page3">Older</a>
  
  
    <a class="pagination-item newer" href="/">Newer</a>
  
</div>

            </div>
          </div>
      </div>
      </main>

      <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="col-8">
              <ul class="nav nav-footer">
          	    <li><a href="/index.html">Home</a></li>
                <li><a href="/blog">About Me</a></li>
                <li><a href="/about">Archives</a></li>
              </ul>
            </div>
            <div class="col-4">
              <ul class="nav nav-footer">
                <li><a href="http://twitter.com/huzi94"><i class="fab fa-twitter fa-lg"></i></a></li>
                <li><a href="http://github.com/huzeifa"><i class="fab fa-github fa-lg"></i></a></li>
              </ul>
            </div>
          </div>
        </div>
      </footer>
    
  </body>
</html>
